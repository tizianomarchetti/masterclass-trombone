<div class="container">
    <div class="row pt-5 pb-3 text-center">
        <h1 class="text-red">{{'menu.label.subscription' | translate}}</h1>
        <h5 class="mt-2 text-decoration-underline">{{'text.subscription.deadline' | translate}}</h5>
    </div>
    
    <div id="errorMessage" class="row mt-3">
        <p class="mb-4">
            {{'text.subscription.intro' | translate}}
        </p>
        <ul class="list-unstyled">
            <li class="mb-3" [innerHTML]="'text.subscription.form_fill' | translate"></li>
            <li class="mb-3" [innerHTML]="'text.subscription.attachement' | translate"></li>
            <li class="mb-3" [innerHTML]="'text.subscription.sending' | translate"></li>
        </ul>
    </div>

    <div class="row" [class.pt-4]="!valid">
        <p *ngIf="!valid" class="text-danger fw-bold">{{'text.subscription.form.error' | translate}}</p>
    </div>

    <div class="row m-2 mt-3 p-3 border border-2" style="border-color: #8e1818!important;">
        <p><small><em>({{'text.subscription.payment.copy' | translate}})</em></small></p>
        <ul class="list-unstyled">
            <li class="mb-2">{{'text.subscription.payment.to' | translate}} 
                <strong role="button" [class.text-success]="copied.intestazione" (click)="copy($event, 'intestazione')">
                    {{!copied.intestazione ? 'Associazione Culturale Filarmonica Giuseppe Verdi' : ('text.subscription.payment.copied.to' | translate)}}
                    &nbsp;<i *ngIf="copied.intestazione" class="fa-solid fa-check text-success"></i>
                </strong>
            </li>
            <li class="mb-2">IBAN 
                <strong role="button" [class.text-success]="copied.iban" (click)="copy($event, 'iban')">
                    {{!copied.iban ? 'IT18D0538773670000042131435' : ('text.subscription.payment.copied.code' | translate)}}
                    &nbsp;<i *ngIf="copied.iban" class="fa-solid fa-check text-success"></i>
                </strong>
            </li> 
            <li class="mb-2">{{'text.subscription.payment.reference' | translate}} 
                <strong role="button" [class.text-success]="copied.causale" (click)="copy($event, 'causale')">
                    {{!copied.causale ? ('Iscrizione Masterclass trombone 2024 - ' + fullName) : ('text.subscription.payment.copied.reference' | translate)}}
                    &nbsp;<i *ngIf="copied.causale" class="fa-solid fa-check text-success"></i>
                </strong>
            </li>
        </ul>
    </div>
    
    <form class="row g-3 mt-3" enctype="multipart/form-data">
        <div class="col-md-6">
            <label for="name" class="form-label fw-bold">{{'text.subscription.form.name' | translate}}*</label>
            <input type="text" class="form-control" [class.border-danger]="!validForm.name" (keyup)="!valid ? validateForm() : refreshFullName()" id="name" name="name" 
                [(ngModel)]="form.name">
        </div>
        <div class="col-md-6">
            <label for="surname" class="form-label fw-bold">{{'text.subscription.form.surname' | translate}}*</label>
            <input type="text" class="form-control" [class.border-danger]="!validForm.surname" (keyup)="!valid ? validateForm() : refreshFullName()" id="surname" name="surname" 
                [(ngModel)]="form.surname">
        </div>
        <div class="col-md-6">
            <label for="phone" class="form-label fw-bold">{{'text.subscription.form.phone' | translate}}*</label>
            <input type="tel" pattern="[0-9]" class="form-control" [class.border-danger]="!validForm.phone" (keyup)="!valid ? validateForm() : null" id="phone" name="phone" 
                [(ngModel)]="form.phone">
        </div>
        <div class="col-md-6">
            <label for="email" class="form-label fw-bold">{{'text.subscription.form.email' | translate}}*</label>
            <input type="email" class="form-control" [class.border-danger]="!validForm.email" (keyup)="!valid ? validateForm() : null" id="email" name="email" 
                [(ngModel)]="form.email">
        </div>
        <fieldset class="col-12 py-4">
            <div class="form-check" role="button">
                <input class="form-check-input" role="button" type="radio" name="subscriptionType" id="subscriptionType1" 
                    [value]="false" [(ngModel)]="form.fullPack" [checked]="!form.fullPack">
                <label class="form-check-label" role="button" for="subscriptionType1">
                    {{'text.program.master_only' | translate}}
                </label>
            </div>
            <div class="form-check" role="button">
                <input class="form-check-input" role="button" type="radio" name="subscriptionType" id="subscriptionType2" 
                    [(ngModel)]="form.fullPack" [value]="true" [checked]="form.fullPack">
                <label class="form-check-label" role="button" for="subscriptionType2">
                    {{'text.program.full_pack' | translate}}
                </label>
            </div>
        </fieldset>
        
        <div class="col-12">
            <strong>{{'text.subscription.form.pieces.header' | translate}}</strong>
        </div>
        <ng-container *ngFor="let item of form.brani; let i = index">
            <div class="col-md-6">
                <label [for]="'title_' + i" class="form-label">{{'text.subscription.form.pieces.title' | translate}}*</label>
                <input type="text" class="form-control" [class.border-danger]="!validForm.brani[i]?.title" (keyup)="!valid ? validateForm() : null" 
                    [id]="'title_' + i" [name]="'title_' + i" [(ngModel)]="form.brani[i].title">
            </div>
            <div class="col-md-5">
                <label [for]="'author_' + i" class="form-label">{{'text.subscription.form.pieces.author' | translate}}*</label>
                <input type="text" class="form-control" [class.border-danger]="!validForm.brani[i]?.author" (keyup)="!valid ? validateForm() : null" 
                    [id]="'author_' + i" [name]="'author_' + i" [(ngModel)]="form.brani[i].author">
            </div>
            <div class="col-md-1 d-flex align-items-end pb-2">
                <label for=""></label>
                <a role="button" class="text-red text-underline" (click)="removeBrano(i)">{{'text.subscription.form.pieces.remove' | translate}}</a>
            </div>
        </ng-container>
        <p>
            <a role="button" class="text-red text-underline" (click)="addBrano()">
                <i class="fa-solid fa-plus"></i>
                {{'text.subscription.form.pieces.add' | translate}}
            </a>
        </p>
        
        <div class="col-12">
            <label for="intolleranze" class="form-label fw-bold">{{'text.subscription.form.intolerances' | translate}}</label>
            <textarea class="form-control" id="intolleranze" rows="3" name="intolleranze" [(ngModel)]="form.intolleranze"></textarea>
        </div>

        <div class="col-12">
            <label for="formFile" class="form-label fw-bold">{{'text.subscription.form.receipt' | translate}}*</label>
            <div class="d-flex">
                <input class="form-control" [class.border-danger]="!validForm.file" type="file" id="formFile" 
                    accept="application/pdf" (change)="uploadFile($event)">
                <div *ngIf="form.file !== null" class="p-2">
                    <i class="fa-solid fa-x text-red" role="button" (click)="uploadFile(null)"></i>
                </div>
            </div>
            <small *ngIf="formatError" class="text-danger fw-bold">{{'text.subscription.form.format' | translate}}</small>
        </div>
        
        <div class="col-12 mt-5">
            <button type="submit" (click)="sendSubscription()" class="btn bg-red text-light w-100">{{'text.subscription.form.send' | translate}}</button>
        </div>
    </form>

    <div class="row mt-5">
        <p [innerHTML]="'text.subscription.form.alternative' | translate"></p>
    </div>
</div>

<div class="modal fade" id="esito" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Iscrizione Masterclass</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <p>{{esito.message}}</p>
        </div>
        <div class="modal-footer">
            <button type="button" [class]="'btn btn-' + (esito.ok ? 'success' : 'danger') + ' text-light'" 
                data-bs-dismiss="modal">Chiudi</button>
        </div>
        </div>
    </div>
</div>